<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Downloader</title>
</head>
<body>
    <h1>File Downloader</h1>
    <p id="status">Status: Checking network...</p>
    <p id="downloaded">Total Downloaded: 0 KB</p>
    <button id="downloadButton" disabled>Start Download</button>

    <script>
        let totalDownloaded = 0;
        let isConnected = navigator.onLine;

        const statusElement = document.getElementById('status');
        const downloadedElement = document.getElementById('downloaded');
        const downloadButton = document.getElementById('downloadButton');

        const checkConnection = () => {
            if (isConnected) {
                statusElement.textContent = 'Status: Connected to network';
                downloadButton.disabled = false;
            } else {
                statusElement.textContent = 'Status: Not connected to network';
                downloadButton.disabled = true;
            }
        };

        const updateDownloadProgress = (bytes) => {
            totalDownloaded += bytes / 1024; // Convert bytes to KB
            downloadedElement.textContent = `Total Downloaded: ${totalDownloaded.toFixed(2)} KB`;
        };

        const downloadFile = async () => {
            const response = await fetch('https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf');
            const reader = response.body.getReader();
            let done = false;

            while (!done) {
                const { value, done: readerDone } = await reader.read();
                if (value) {
                    updateDownloadProgress(value.length);
                }
                done = readerDone;
            }

            // Start downloading the file again once done
            downloadFile();
        };

        // Check connection when the page loads
        checkConnection();

        // Listen for network changes
        window.addEventListener('online', () => {
            isConnected = true;
            checkConnection();
        });

        window.addEventListener('offline', () => {
            isConnected = false;
            checkConnection();
        });

        // Start downloading the file when the button is clicked
        downloadButton.addEventListener('click', () => {
            if (isConnected) {
                downloadFile();
            }
        });
    </script>
</body>
</html>
